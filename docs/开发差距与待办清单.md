## 1. 目的

本文档基于课堂需求文档 `class/j2ee-ssm系统需求设计.md` 与课程设计报告要求 `class/设计报告要求.md`，
对当前仓库代码进行对照盘点，明确“已实现/未实现/需补齐”的开发清单，便于后续编码与撰写设计报告。

## 1.1 赶工版范围与取舍（对齐老师建议 + 课堂需求）

本项目验收与报告建议以 `class/j2ee-ssm系统需求设计.md` 的用例编号为准（B1~B6 / C1~C5 / D1~D5 / E1~E4），老师建议文本用于口径解释：

- “电话预订/取消”：可由后台员工在预定单管理中手工新增/编辑/删除来覆盖（相当于线下录单）。
- “注销”：在课堂需求里描述为“安全退出登录状态”，等价于“退出登录”（不是删除账号）。
- 赶工策略：优先完成“可演示的最小闭环”，对工作量大的扩展项提供“最小实现/完整实现”两档，避免为了贴合文档而大改现有数据模型。

## 2. 当前已实现的主要功能（按模块归类）

### 2.1 前台（顾客/会员）

- 客房/房型浏览：`src/com/ischoolbar/programmer/controller/home/HomeController.java`
- 注册/登录/退出：`src/com/ischoolbar/programmer/controller/home/HomeController.java`
- 会员中心（查看个人订单列表、修改个人信息、修改密码）：`src/com/ischoolbar/programmer/controller/home/HomeAccountController.java`
- 在线预订（支持游客/会员下单）：`src/com/ischoolbar/programmer/controller/home/HomeAccountController.java`（`/home/account/book_order`）

### 2.2 后台（员工/管理员）

后台登录、菜单、角色、用户、权限（按菜单授权）：`src/com/ischoolbar/programmer/controller/admin/SystemController.java` 及 `admin/*Controller.java`

- 订单（预定）管理：`src/com/ischoolbar/programmer/controller/admin/BookOrderController.java`
  - 支持新增/编辑/删除/查询预定单（页面：`WebContent/WEB-INF/views/book_order/list.jsp`）
- 入住管理：`src/com/ischoolbar/programmer/controller/admin/CheckinController.java`
- 客房与基础数据：房间/房型/楼层/客户信息等后台管理（`admin/RoomController`、`admin/RoomTypeController`、`admin/FloorController`、`admin/AccountController`）
- 系统日志：`src/com/ischoolbar/programmer/controller/admin/LogController.java`
- 营业统计（图表）：`src/com/ischoolbar/programmer/controller/admin/StatsController.java`

### 2.3 数据库（已有表）

当前初始化脚本：`db_hotel_ssm.sql`，主要表包括：

- 用户/权限：`user`、`role`、`menu`、`authority`、`log`
- 业务：`room_type`、`room`、`floor`、`account`、`book_order`、`checkin`

## 3. 与课堂需求的差距（需要补充开发）

下面按 `class/j2ee-ssm系统需求设计.md` 的功能点逐项对照。

### 3.1 预订功能（B1~B6）

- ✅ B1 浏览客房信息：已实现（前台房型列表）
- ✅ B2 在线预订：已支持游客直接预订（未登录时自动创建账号并登录：用户名=手机号，初始密码=身份证后6位）
- ✅ B3 取消预订（顾客侧）：已实现（"我的订单"可取消"待确认/已确认"订单，并回滚房型可用数/预定数）
- ✅ B4 修改预订（顾客侧）：已实现（"我的订单"可修改"待确认/已确认"订单：日期/房型/联系人信息等；已确认订单修改后回到待确认状态）
- ✅ B5 查询订单：已增强（支持按状态/房型/日期筛选，状态包括：待确认/已确认/已入住/已完成/已取消）
- ❌ B6 查看活动：未实现（课堂需求/老师建议均提到，建议做"最小活动公布"版本，见 3.3）

✅ **已完成（2026-01-03）：订单状态系统重构**
- 重构订单状态枚举：0待确认/1已确认/2已入住/3已完成/4已取消
- 后台新增"确认订单"和"取消订单"功能（含房型数量联动）
- 前台支持"待确认/已确认"订单的修改和取消
- 入住管理仅允许"已确认"订单办理入住
- 删除订单仅允许删除"已取消"订单
- 完善订单状态流转闭环：待确认→已确认→已入住→已完成/已取消

建议开发任务：

1. ✅ ~~预订状态与闭环补齐~~：已完成
2. ✅ 后台"电话预订/取消"口径：后台预定单管理已具备增删改查+确认+取消，可在页面/报告中明确其覆盖线下录单场景
3. 活动模块完成后：前台首页展示活动列表/详情（见 3.3）

### 3.2 会员功能（C1~C5）

- ✅ C1 用户注册：已实现
- ✅ C2 会员登录：已实现
- ⚠️ C5 个人信息管理：已实现（修改资料/密码）
- ❌ C3 积分管理：未实现（数据库与代码缺少积分字段与累积逻辑）
- ❌ C4 会员等级查看：未实现（数据库与代码缺少等级字段与升级逻辑）
- ❌ 会员等级折扣（九折/八折）：未实现（下单价格未按等级计算）
- ✅ 注销（退出登录）：已实现（课堂需求描述为“安全退出登录状态”）
- ⚠️ 忘记密码/重置密码：课堂需求提到“系统应提供忘记密码等辅助功能”，赶工可放到 P2（在报告中说明未实现）

建议开发任务（建议方案 A，尽量少动现有结构）：

- 方案 A（推荐）：在现有 `account` 上扩展字段（最贴合课堂需求且改动面最小）
  - 最小实现（建议 P0）：只做 `level` + 折扣价计算
    - 增加 `level`（等级，1=九折，2=八折）字段，默认 1
    - 预订下单/入住结算展示“原价/折扣/实付”，并按 `level` 计算折扣（0.9/0.8）
  - 完整实现（建议 P1）：补齐 `points` + 自动升级
    - 增加 `points`（积分）字段；在“离店/结算”环节累积积分并自动更新 `level`
- 方案 B：新增独立 `member` 表（与 `account` 关联）
  - 更贴近课堂文档的 ER，但需要同步改 Mapper/Service/页面与历史数据迁移，赶工不推荐

### 3.3 酒店活动公布（ACTIVITY）

需求要求“系统首页展示活动”，当前缺少：

- 活动表结构
- 活动管理后台（新增/编辑/上下架）
- 活动前台展示页面

建议开发任务：

1. 最小实现（建议 P0）：活动“公布/展示”闭环
   - 新增 `activity` 表（标题、内容、开始/结束时间、状态、创建时间）
   - 新增后台管理：`/admin/activity/*`（列表/新增/编辑/删除/上下架）
   - 新增前台展示：首页活动区 + 活动详情页
2. 完整实现（建议 P1）：补齐课堂文档里更细的字段与规则（例如折扣率、目标等级、时间状态自动切换）

### 3.4 员工系统（D1~D5）

- ✅ D1 员工登录：已实现（后台系统登录）
- ✅ D2 创建订单：后台预定管理支持新增预定单
- ✅ D3 订单管理：已实现增删改查+确认订单+取消订单（含操作日志记录）
- ⚠️ D4 客房状态维护：已有房间/入住管理，但状态模型与需求文档（空闲/已预订/已入住/清洁中/维修中）需要统一
- ⚠️ D5 客户信息查询：后台存在客户（`account`）管理，可进一步补齐查询维度与关联订单视图

建议开发任务：

1. ✅ ~~新增"确认订单"动作~~：已完成（含操作日志记录）
2. ✅ ~~统一状态枚举与页面展示文案~~：已完成（待确认→已确认→已入住→已完成/已取消）
3. 房态枚举对齐课堂需求：`room.status` 建议统一为“空闲/已预订/已入住/清洁中/维修中”，并明确哪些业务动作会触发房态变更

### 3.5 管理功能（E1~E4）

- ✅ E1 员工账户管理：以后台 `user/role/menu/authority` 体系实现（可视为员工权限管理）
- ✅ E2 客房信息管理：已实现（房间/房型/楼层）
- ⚠️ E3 房型价格设置：房型管理已具备字段，但需确认前台展示/下单使用的价格字段一致
- ⚠️ E4 系统监控：当前有日志与统计，但“监控”可在报告中定义为：
  - 登录日志/操作日志（已有 `log`）
  - 营业统计（已有 `stats`）
  - 关键异常与告警（可选增强）

## 4. 与设计报告要求相关的“必须补齐项”

`class/设计报告要求.md` 里要求报告内容最终要能对应到实现代码，建议额外补齐：

1. 数据库设计一致性
   - 课堂需求文档里的 E-R 与本项目实际表结构目前不一致（缺少 ACTIVITY、积分/等级字段；概念上的 USER/MEMBER/ORDER 与现有 `account/book_order/checkin` 的模型也不同）
   - 赶工建议：优先采用“扩展现有表”的最小实现（`account` 增加积分/等级字段 + 新增 `activity` 表），并在报告中给出概念实体到实际表的映射说明
2. 主要业务流程图（建议至少 1 个）
   - 在线预订流程（含折扣/积分/确认/取消）
3. 核心功能代码截图与说明
   - Controller/Service/Mapper 三层调用链 + 关键 SQL

## 5. 推荐开发优先级（按最小闭环）

P0（必须，优先完成）：

1. ✅ ~~员工侧"确认订单"+ 订单状态闭环~~：**已完成（2026-01-03）**
   - 已实现状态流转与页面联动，对齐"待确认→已确认→已入住→已完成/已取消"
   - 后台新增确认订单和取消订单按钮，含房型数量联动
   - 前台支持待确认/已确认订单的修改和取消
2. 会员等级折扣（最小实现）（难度：中；`level` 字段 + 九折/八折价格计算与展示，积分累积可后置）
3. 活动公布（最小实现）（难度：中；新增表 + 后台发布/上下架 + 前台展示列表/详情）

P1（建议完成）：

1. 积分累积 + 自动升级（难度：中-高；把积分与"离店/结算"动作绑定，规则简单可解释）
2. 房态枚举与联动完善（难度：中-高；空闲/已预订/已入住/清洁中/维修中，联动点较多）

P2（可选加分）：

1. 忘记密码/重置密码
2. 更完善的系统监控（异常告警、操作审计更细）

赶工进一步压缩（备选）：

1. 若时间极紧：优先完成 P0 的 2+3；P0-1 已完成
2. "积分自动升级""房态联动"属于改动面较大的联动项，建议排到最后，避免影响预订主流程稳定性

